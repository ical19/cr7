<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CR7 Redirect</title>
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <script>
    // Konfigurasi Supabase (ganti sesuai project kamu)
    const supabaseUrl = "https://YOUR_PROJECT.supabase.co";
    const supabaseKey = "YOUR_PUBLIC_ANON_KEY";
    const supabase = supabase.createClient(supabaseUrl, supabaseKey);

    async function checkAuthState() {
      try {
        const { data: { session }, error } = await supabase.auth.getSession();

        if (error) {
          console.error("Error checking session:", error.message);
          window.location.href = "login.html";
          return;
        }

        if (!session) {
          // Belum login
          window.location.href = "login.html";
          return;
        }

        // Jika sudah login → ambil user dan role
        const user = session.user;

        // Misalnya role disimpan di user metadata (auth.users -> raw_user_meta_data)
        const role = user.user_metadata?.role || null;

        // Arahkan sesuai role
        switch (role) {
          case "teknisi":
            window.location.href = "teknisi.html";
            break;
          case "sparepart":
            window.location.href = "sparepart.html";
            break;
          case "sa":
            window.location.href = "sa.html";
            break;
          case "mra":
            window.location.href = "mra.html";
            break;
          default:
            // role tidak ada → fallback ke login
            window.location.href = "login.html";
        }

      } catch (err) {
        console.error("Error checking auth state:", err);
        window.location.href = "login.html";
      }
    }

    document.addEventListener("DOMContentLoaded", checkAuthState);
  </script>
</head>
<body>
  <p>Sedang mengarahkan...</p>
</body>
</html>
